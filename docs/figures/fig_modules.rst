..  Copyright 2013-2021 The Salish Sea MEOPAR contributors
..  and The University of British Columbia
..
..  Licensed under the Apache License, Version 2.0 (the "License");
..  you may not use this file except in compliance with the License.
..  You may obtain a copy of the License at
..
..     https://www.apache.org/licenses/LICENSE-2.0
..
..  Unless required by applicable law or agreed to in writing, software
..  distributed under the License is distributed on an "AS IS" BASIS,
..  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
..  See the License for the specific language governing permissions and
..  limitations under the License.

.. _FigureModulesOrganization:

***************************
Figure Modules Organization
***************************

Web site figures are generated by code modules stored in the :file:`nowcast/figures/` directory tree.
There are 5 sub-directories in that tree:

* :file:`fvcom/`
* :file:`comparison/`
* :file:`publish/`
* :file:`research/`

The :file:`fvcom/` directory contains modules for figures that show results from the VHFR FVCOM model.

The :file:`comparison/` directory contains modules for figures that compare model results to observations;
for example temperature and salinity comparisons at the deep ONC nodes,
and comparison of surface quantities to data from the ONC ferry instrument packages.

The :file:`publish/` directory contains modules for figures that are considered to be "official" SalishSeaCast model product - results we have evaluated and believe to be of the best quality and accuracy.

The :file:`research/` directory contains modules for figures that we're interested in looking at on a daily basis to gain insight into the model's performance.

The :file:`wwatch3/` directory contains modules for figures that show results from the Strait of Georgia WaveWatchIIIâ„¢ model.

The :file:`research/` directory is generally where new figure modules for NEMO results should be put.

In Python terms,
those directories are namespaces from which figure modules can be imported:

* :py:obj:`nowcast.figures.fvcom`
* :py:obj:`nowcast.figures.comparison`
* :py:obj:`nowcast.figures.publish`
* :py:obj:`nowcast.figures.research`
* :py:obj:`nowcast.figures.wwatch3`

Within each of those namespaces the figure-producing functions are organized into a module for each figure.
So,
for example,
the :py:mod:`nowcast.figures.research.tracer_thalweg_and_surface` module contains the code to produce a figure showing colour contours of a tracer on a vertical slice along a section of the domain thalweg,
and on the surface for a section of the domain that excludes Puget Sound in the south and Johnstone Strait in the north.

The code in the figure modules is just the code that is specific to creating that one figure.
Generic functions that are useful in the creation of more than one figure are collected in the :py:obj:`nowcast.figures.shared` module.
Figure modules also often import modules from the :ref:`SalishSeaToolsPackage`.
For example,
:py:func:`salishsea_tools.viz_tools.set_aspect` is used to set the aspect ratio of a figure axes object appropriately for the Salish Sea NEMO model grid.

The :ref:`CreatingAFigureModule` docs contain a detailed element-by-element discussion of how to create and structure a web site figure module.
They use the :py:mod:`nowcast.figures.research.tracer_thalweg_and_surface` module as an example.

The `DevelopTracerThalwegAndSurfaceModule`_ notebook in :file:`notebooks/figures/research/` is an example of developing figure module functions in a Jupyter notebook.
You can take that approach if you wish,
or you can develop directly in a module.

.. _DevelopTracerThalwegAndSurfaceModule: https://nbviewer.jupyter.org/github/SalishSeaCast/SalishSeaNowcast/blob/main/notebooks/figures/research/DevelopTracerThalwegAndSurfaceModule.ipynb

Of course,
the ultimate goal is to produce a module.
Once you've got a code module,
you should create a notebook that tests it in the nowcast system context.
The `TestTracerThalwegAndSurfaceModule`_ notebook in :file:`notebooks/figures/research/` is an example for the :py:mod:`nowcast.figures.research.tracer_thalweg_and_surface` module.

.. _TestTracerThalwegAndSurfaceModule: https://nbviewer.jupyter.org/github/SalishSeaCast/SalishSeaNowcast/blob/main/notebooks/figures/research/TestTracerThalwegAndSurface.ipynb
